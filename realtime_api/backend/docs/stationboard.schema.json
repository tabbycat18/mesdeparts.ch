{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mesdeparts.ch/schemas/stationboard.json",
  "$comment": "Schema for the stationboard API response. Validated in CI by backend_schema_check.yml.",
  "title": "MesDeparts Stationboard Response",
  "type": "object",
  "required": ["departures", "rt", "alerts"],
  "properties": {
    "station": { "type": ["object", "null"] },
    "banners": { "type": "array", "items": { "type": "object" } },
    "resolved": { "type": ["object", "null"] },
    "rt": { "$ref": "#/$defs/rtMeta" },
    "alerts": { "$ref": "#/$defs/alertsMeta" },
    "departures": {
      "type": "array",
      "items": { "$ref": "#/$defs/departure" }
    },
    "debug": { "type": ["object", "null"] }
  },
  "$defs": {
    "rtMeta": {
      "type": "object",
      "required": [
        "available",
        "applied",
        "reason",
        "feedKey",
        "fetchedAt",
        "cacheFetchedAt",
        "cacheAgeMs",
        "ageMs",
        "freshnessThresholdMs",
        "ageSeconds",
        "instance",
        "status"
      ],
      "properties": {
        "available": { "type": "boolean" },
        "applied": { "type": "boolean" },
        "reason": { "type": "string", "enum": ["fresh", "stale", "missing", "disabled", "guarded"] },
        "feedKey": { "type": "string" },
        "fetchedAt": { "type": ["string", "null"], "format": "date-time" },
        "cacheFetchedAt": { "type": ["string", "null"], "format": "date-time" },
        "cacheAgeMs": { "type": ["integer", "null"] },
        "ageMs": { "type": ["integer", "null"] },
        "freshnessThresholdMs": { "type": "integer" },
        "ageSeconds": { "type": ["integer", "null"] },
        "freshnessMaxAgeSeconds": { "type": ["integer", "null"] },
        "cacheStatus": { "type": ["string", "null"] },
        "status": { "type": ["integer", "null"] },
        "lastStatus": { "type": ["integer", "null"] },
        "lastError": { "type": ["string", "null"] },
        "payloadBytes": { "type": ["integer", "null"] },
        "instance": {
          "type": "object",
          "required": ["id", "allocId", "host", "pid", "build"],
          "properties": {
            "id": { "type": "string" },
            "allocId": { "type": ["string", "null"] },
            "host": { "type": "string" },
            "pid": { "type": "integer" },
            "build": { "type": "string" }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "alertsMeta": {
      "type": "object",
      "required": ["available", "applied", "reason", "fetchedAt", "ageSeconds"],
      "properties": {
        "available": { "type": "boolean" },
        "applied": { "type": "boolean" },
        "reason": { "type": "string" },
        "fetchedAt": { "type": ["string", "null"], "format": "date-time" },
        "ageSeconds": { "type": ["integer", "null"] },
        "includeRequested": { "type": ["boolean", "null"] },
        "includeApplied": { "type": ["boolean", "null"] }
      },
      "additionalProperties": true
    },
    "departure": {
      "type": "object",
      "required": [
        "line",
        "destination",
        "scheduledDeparture",
        "cancelled"
      ],
      "properties": {
        "key": { "type": ["string", "null"] },
        "trip_id": { "type": ["string", "null"] },
        "route_id": { "type": ["string", "null"] },
        "stop_id": { "type": ["string", "null"] },
        "stop_sequence": { "type": ["integer", "null"] },
        "category": { "type": ["string", "null"] },
        "number": { "type": ["string", "null"] },
        "line": { "type": ["string", "null"] },
        "destination": { "type": ["string", "null"] },
        "operator": { "type": ["string", "null"] },
        "scheduledDeparture": { "type": "string", "format": "date-time" },
        "realtimeDeparture": { "type": ["string", "null"], "format": "date-time" },
        "delayMin": { "type": ["integer", "null"] },
        "platform": { "type": ["string", "null"] },
        "platformChanged": { "type": ["boolean", "null"] },
        "previousPlatform": { "type": ["string", "null"] },
        "cancelled": { "type": "boolean" },
        "status": { "type": ["string", "null"] },
        "cancelReasonCode": { "type": ["string", "null"] },
        "stopEvent": { "type": ["string", "null"] },
        "replacementType": { "type": ["string", "null"] },
        "flags": { "type": "array", "items": { "type": "string" } },
        "alerts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": ["string", "null"] },
              "severity": { "type": ["string", "null"] },
              "header": { "type": ["string", "null"] },
              "description": { "type": ["string", "null"] }
            },
            "additionalProperties": true
          }
        },
        "debug": { "type": ["object", "null"], "additionalProperties": true }
      },
      "additionalProperties": true
    }
  }
}
