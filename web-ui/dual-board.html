<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ATB10 Lite Dual Board Wrapper</title>
  <style>
    /* Set your two URLs below (left and right). This file is meant to live on the tablet only. */
    :root {
      color-scheme: dark;
    }
    html, body {
      margin: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    }
    .wrap {
      display: flex;
      height: 100vh;
      width: 100vw;
      gap: 2px;
      background: #000;
    }
    .pane {
      flex: 1 1 50%;
      border: none;
      background: #000;
    }
    .controls {
      position: fixed;
      top: 8px;
      left: 8px;
      right: 8px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      gap: 8px;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid #222;
      padding: 8px 10px;
      border-radius: 10px;
      color: #f5f5f5;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
    }
    .controls.is-hidden {
      display: none;
    }
    .controls__form {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      width: 100%;
    }
    .controls__group {
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1 1 260px;
      min-width: 0;
    }
    .controls label {
      font-size: 0.85rem;
      color: #cfd6e0;
      white-space: nowrap;
    }
    .controls input[type="url"] {
      flex: 1 1 auto;
      min-width: 0;
      background: #0d0d0d;
      color: #fff;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 6px 8px;
      font-size: 0.95rem;
    }
    .controls input[type="url"]::placeholder {
      color: #7d8491;
    }
    .controls button {
      background: #1f6feb;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 10px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .controls button:hover {
      background: #2a7dfc;
    }
    .controls button.secondary {
      background: #2b2f3a;
      color: #d5d9e0;
    }
    .controls button.secondary:hover {
      background: #3a3f4b;
    }
    .status {
      font-size: 0.8rem;
      color: #9ec4ff;
      min-width: 160px;
      flex: 0 0 auto;
    }
    .status[data-state="error"] {
      color: #ff9aa2;
    }
    .controls-toggle {
      position: fixed;
      top: 8px;
      left: 8px;
      z-index: 9;
      background: rgba(0, 0, 0, 0.7);
      color: #f5f5f5;
      border: 1px solid #222;
      border-radius: 8px;
      padding: 8px 10px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
    }
    .controls-toggle:hover {
      background: rgba(20, 20, 20, 0.9);
    }
    @media (max-width: 800px) {
      .controls {
        position: static;
        border-radius: 0;
        border-left: none;
        border-right: none;
      }
    }
    .warning {
      color: #fff;
      display: grid;
      place-items: center;
      text-align: center;
      padding: 1.5rem;
      gap: 0.5rem;
    }
    .warning code {
      background: #111;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <button type="button" class="controls-toggle" id="showControls" hidden>Show picker</button>
  <div class="controls">
    <form id="boardForm" class="controls__form">
      <div class="controls__group">
        <label for="leftUrl">Left</label>
        <input
          id="leftUrl"
          name="left"
          type="url"
          inputmode="url"
          placeholder="https://..."
          required
        />
      </div>
      <div class="controls__group">
        <label for="rightUrl">Right</label>
        <input
          id="rightUrl"
          name="right"
          type="url"
          inputmode="url"
          placeholder="https://..."
          required
        />
      </div>
      <button type="submit">Load boards</button>
      <button type="button" class="secondary" id="swapBtn">Swap</button>
      <button type="button" class="secondary" id="resetBtn">Reset</button>
      <button type="button" class="secondary" id="hideBtn">Hide</button>
      <div class="status" id="status" aria-live="polite"></div>
    </form>
  </div>
  <div class="wrap" id="wrapper">
    <iframe class="pane" id="leftPane" title="Left board"></iframe>
    <iframe class="pane" id="rightPane" title="Right board"></iframe>
  </div>

  <script>
    // Replace these two URLs with the boards you want on the tablet.
    // Example: const LEFT_DEFAULT = "https://mesdeparts.ch/?stationName=...&stationId=...";
    const LEFT_DEFAULT = "https://mesdeparts.ch/?stationName=Lausanne%2C+Motte&stationId=8592082";
    const RIGHT_DEFAULT = "https://mesdeparts.ch/?stationName=Lausanne";
    const STORAGE_KEY = "dualBoardUrls.v1";

    const params = new URLSearchParams(location.search);
    const saved = (() => {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
      } catch {
        return {};
      }
    })();

    const sanitizeUrl = (url) => {
      if (!url) return "";
      try {
        const parsed = new URL(url);
        if (parsed.protocol !== "https:" && parsed.protocol !== "http:") return "";
        return parsed.toString();
      } catch {
        return "";
      }
    };

    const leftUrl =
      sanitizeUrl(params.get("left")) ||
      sanitizeUrl(saved.left) ||
      LEFT_DEFAULT;
    const rightUrl =
      sanitizeUrl(params.get("right")) ||
      sanitizeUrl(saved.right) ||
      RIGHT_DEFAULT;

    const leftFrame = document.getElementById("leftPane");
    const rightFrame = document.getElementById("rightPane");
    const wrapper = document.getElementById("wrapper");
    const form = document.getElementById("boardForm");
    const leftInput = document.getElementById("leftUrl");
    const rightInput = document.getElementById("rightUrl");
    const statusEl = document.getElementById("status");
    const swapBtn = document.getElementById("swapBtn");
    const resetBtn = document.getElementById("resetBtn");
    const hideBtn = document.getElementById("hideBtn");
    const showBtn = document.getElementById("showControls");
    const controls = document.querySelector(".controls");

    leftInput.value = leftUrl;
    rightInput.value = rightUrl;

    const setStatus = (msg, state = "info") => {
      statusEl.textContent = msg;
      statusEl.dataset.state = state;
    };

    const showControls = () => {
      controls.classList.remove("is-hidden");
      showBtn.hidden = true;
    };

    const hideControls = () => {
      controls.classList.add("is-hidden");
      showBtn.hidden = false;
    };

    showBtn.addEventListener("click", showControls);

    const applyBoards = (l, r, { updateQuery = true, showStatus = true } = {}) => {
      const cleanLeft = sanitizeUrl(l);
      const cleanRight = sanitizeUrl(r);
      if (!cleanLeft || !cleanRight) {
        if (showStatus) setStatus("Please enter valid http(s) URLs.", "error");
        return false;
      }

      leftFrame.src = cleanLeft;
      rightFrame.src = cleanRight;

      if (updateQuery) {
        const nextParams = new URLSearchParams();
        nextParams.set("left", cleanLeft);
        nextParams.set("right", cleanRight);
        history.replaceState({}, "", `${location.pathname}?${nextParams.toString()}`);
      }

      try {
        localStorage.setItem(
          STORAGE_KEY,
          JSON.stringify({ left: cleanLeft, right: cleanRight }),
        );
      } catch {
        /* ignore */
      }

      if (showStatus) setStatus("Boards updated.");
      return true;
    };

    const initialApplied = applyBoards(leftUrl, rightUrl, { updateQuery: !!(params.get("left") || params.get("right")), showStatus: false });
    if (!initialApplied) {
      wrapper.innerHTML = `
        <div class="warning">
          <div>Enter two valid URLs below.</div>
          <div>You can also pass them via the address bar: <code>?left=...&right=...</code></div>
        </div>
      `;
    }

    form.addEventListener("submit", (event) => {
      event.preventDefault();
      applyBoards(leftInput.value.trim(), rightInput.value.trim());
    });

    swapBtn.addEventListener("click", () => {
      const currentLeft = leftInput.value.trim();
      leftInput.value = rightInput.value.trim();
      rightInput.value = currentLeft;
      applyBoards(leftInput.value, rightInput.value);
    });

    resetBtn.addEventListener("click", () => {
      leftInput.value = LEFT_DEFAULT;
      rightInput.value = RIGHT_DEFAULT;
      applyBoards(LEFT_DEFAULT, RIGHT_DEFAULT);
    });

    hideBtn.addEventListener("click", hideControls);
  </script>
</body>
</html>
